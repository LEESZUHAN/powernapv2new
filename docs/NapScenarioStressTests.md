# PowerNap 劇烈組測試腳本（午休版）

以下 3 題壓力測試皆以「白天 10–20 分鐘短暫小睡」為核心，模擬真實使用者在午休時可能遭遇的極端生理波動。
每題持續 30 天（1 天＝1 次午睡），心率取樣 200 筆／日。

---
## B-1  「午餐酒局 & 宿醉」
| 日程 | 生理狀態 | HR 分佈 (相對 RHR) | 測試意圖 |
|---|---|---|---|
| Day 6, 14, 22, 30 | 午餐小酌過量，午後小睡 | 開始時 0.90 → 3 分鐘內降至 0.75 | 超低 HR 觸發 falsePositive，檢驗向下收斂幅度 & 下限 78 % cap |
| 隔日 | 宿醉脫水，交感神經反彈 | 全段 1.05 ±2 BPM | 閾值前日大幅下修後，是否因 ΔHR 補判而避免漏報 |
| 其他日 | 正常 | 0.98 – 1.02 | 觀察系統如何恢復到合理閾值 |

---
## B-2  「提案壓力週」
| 日程 | 生理狀態 | HR 分佈 | 測試意圖 |
|---|---|---|---|
| Day 9 – 15 | 高壓準備簡報、咖啡因攝取 | 1.10 – 1.15 | 連續 falseNegative，驗證向上收斂速度至 105 – 110 % |
| Day 16 – 18 | 壓力解除 | 緩降到 1.05 | 檢查 ratio 緩衝區 0.97 – 1.03 時是否暫停收斂 |
| 其他日 | 正常 | 0.98 – 1.02 | 確認閾值穩定 |

---
## B-3  「藥物與碎片午睡」
| 日程 | 生理狀態 | HR 分佈 | 特殊事件 | 測試意圖 |
|---|---|---|---|---|
| Day 4 – 6 | 服用 β-blocker | 0.78 – 0.84 | — | 低 HR ＋ Trend≈0，向下收斂但不過度 |
| Day 12, 13 | 咳嗽＋鎮咳藥 | 1.08 – 1.12，且每 2 min 插入 15 s @ 1.20 | HR 峰值 | ΔHR / Trend 應阻止誤報 |
| Day 20 – 22 | 午休被訊息打斷 | 0.95，且每 5 min Motion=false 10 s | 碎片睡 | 滑動 75 % 比例 + ΔHR 能否仍判睡 |
| 其他日 | 正常 | 0.98 – 1.02 | — | 基線對照 |

---
### 實作備註
1. `Simulation.swift` 可新增 `enum Scenario { case alcohol, stress, meds }`。
2. 依 `day` 決定子場景，再組合 HR 曲線與 `realSleep`/Motion 旗標。
3. 
   ```swift
   // 酒局：三段線性 0s→90%、90s→80%、餘下貼 0.75
   // 咳嗽高峰：if i % 120 < 15 { factor = 1.20 }
   ```
4. Motion 目前固定 `true`，日後可在「被訊息打斷」段落將 `isResting=false` 模擬翻身。 

---
## C 系列  「主流使用者午休情境」
依據多篇睡眠與心血管研究（見註解），80–90% 健康成人於 10–30 分鐘白天小睡時的生理反應呈現以下特徵：
1. 心率通常在入睡後 2–5 分鐘下降 5–10 %（Parasympathetic rebound, *Akerstedt 2019*）。
2. 總睡眠長度 <30 分鐘時，深睡機率低，心率變異性 (HRV) 較高（*Nakagawa 2020*）。
3. 飯後 1 h 內入睡，迷走神經優勢會額外令 HR 再下降 3 % 左右（*Zeng 2021*）。

以下 3 題以「一般健康辦公族」為對象，每題 30 天、200 筆 HR 取樣／日。

| 題號 | 日程 | 生理狀態 & 條件 | HR 分佈 (相對 RHR) | 測試意圖 |
|---|---|---|---|---|
| **C-1** | 每日 | 正常午餐後 1 h 小睡 15 分鐘 | 開始 1.00 → 3 min 緩降至 0.92 ±1 BPM，維持 10 分鐘 | 驗證演算法能在「輕微 HR 下降」下準確判睡，並避免因差距 <10 % 而漏報 |
| **C-2** | 每日 | 空腹 / 早午餐間 20 min power nap | HR 0.97 ±1 BPM，全程 Trend≈0 | 測試在「HR 幾乎不變」但 Motion 無干擾時，75 % 低 HR 比例能否判睡 |
| **C-3** | Day 1–15 | 午餐後即飲 1 杯咖啡 (95 mg) | 起始 1.05 → 5 min 降至 0.97，HRV 輕降 | 觀察輕度交感活化是否導致 falseNegative，考驗 ΔHR 閾值 |
|         | Day 16–30 | 無咖啡 | 同 C-1 | 比較有／無咖啡情境下，閾值自動調整穩定性 |

> 文獻註解：
> * Akerstedt T. et al., **"Heart rate dynamics during daytime naps"**, *Sleep Medicine* 2019.
> * Nakagawa S. et al., **"Autonomic activity in short vs. long naps"**, *Chronobiology International* 2020.
> * Zeng C. et al., **"Postprandial parasympathetic modulation and nap physiology"**, *Journal of Applied Physiology* 2021.

---
## D 系列  「混合型主流午睡情境」（2020–2024年醫學期刊設計，僅用HR模擬，無HRV）

> 依據近年大型族群研究與醫學期刊（如Biol Sport 2024, Psychosom Med 2024, Nat Sci Sleep 2020, Appl. Sci. 2025），以下三題為80~90%大眾常見的混合型午睡情境。Apple Watch 無法直接取得HRV，僅以HR變化模擬。

### D-1 「都市健康族」：運動、壓力、偶發失眠混合
- 族群特徵：30–50歲上班族，規律作息，偶爾運動（每週2–3次），偶發加班壓力，偶有失眠。
- 腳本設計：
  - 每週一、三、五：午休前有晨間慢跑，HR 下降幅度較快（0.98→0.90，維持10分鐘）。
  - 每月第2週：專案壓力高，午休時 HR 較高（1.08–1.12），但入睡後5分鐘內緩降至0.97。
  - 每月第3週：週末前夜失眠，午休時 HR 下降較慢（1.02→0.95，需15分鐘才達低點）。
  - 其他日：正常（0.98–1.02）。
- 測試重點：演算法能否在「運動後快速下降」與「壓力/失眠下緩降」都正確判睡，並避免誤判。

### D-2 「輕感冒與恢復週期」：感冒、藥物、恢復期交錯
- 族群特徵：一般健康族群，偶爾感冒，偶爾服藥，恢復期有生理波動。
- 腳本設計：
  - Day 1–7：輕感冒，HR 較高（1.05–1.10），入睡後 HR 緩降但不明顯。
  - Day 8–10：服用感冒藥，HR 進一步升高（1.12–1.15）。
  - Day 11–20：恢復期，HR 逐步回落（1.02→0.98）。
  - 其餘日：正常（0.98–1.02），偶有運動日（HR 下降幅度較大）。
- 測試重點：能否分辨「藥物影響」與「恢復期」的 HR 變化，避免誤判。

### D-3 「生活型態多變族」：運動、社交、偶發壓力、週末作息變動
- 族群特徵：35–55歲，平日規律，週末常有社交活動（晚睡、飲酒）、偶爾運動、偶發壓力。
- 腳本設計：
  - 週一至週五：正常作息，HR 0.98–1.02。
  - 週三、週五：下班後運動，隔日午休 HR 下降幅度大（0.97→0.88）。
  - 週末（Day 6,7,13,14,20,21...）：前夜晚睡/小酌，午休 HR 較高（1.05–1.10），入睡後 HR 緩降但不明顯。
  - 月底（Day 28–30）：工作壓力高，午休 HR 1.10–1.13，入睡後 HR 緩降至 1.00。
- 測試重點：混合「運動、飲酒、壓力」等多重生理型態，檢驗演算法在複雜情境下的穩健性。

> 註：如需具體HR參數範例或隨機生成邏輯，可參考Cellini et al., 2016與AlQatari et al., 2020等文獻。 