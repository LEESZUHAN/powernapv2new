# PowerNap 技術參數表（v1.0.0）

> **文件定位說明**：本文件集中收錄 PowerNap 系統中使用的所有技術參數，作為標準參考源確保所有文件參數一致性。當需要調整任何技術參數時，應首先更新本文件，然後同步到其他相關文檔。
> 
> **與其他文件的關係**：
> - 本文件為所有技術參數的唯一權威來源
> - 所有技術文檔應參考本文件中的參數值
> - 心率系統具體實現請參考 HeartRateSystem.md
> - 收斂系統具體實現請參考 ConvergenceSystem.md
> - 睡眠檢測整體架構請參考 SleepDetectionSystem.md

## 一、年齡組閾值參數

### 心率閾值百分比

根據不同年齡組設定的心率閾值百分比（相對於靜息心率）：

| 參數名稱 | 年齡組 | 判定標準 | 實現值 | 調整範圍 | 參考來源 |
|---------|--------|----------|--------|----------|----------|
| HeartRateThresholdTeen | 10–17 歲 (青少年) | 低於 RHR 的比例 | 87.5% (0.875) | 85-90% | 實際代碼實現及測試結果 |
| HeartRateThresholdAdult | 18–59 歲 (成人) | 低於 RHR 的比例 | 90.0% (0.9) | 88-92% | Burgess 1999 成人實驗資料 |
| HeartRateThresholdSenior | ≥ 60 歲 (銀髮族) | 低於 RHR 的比例 | 93.5% (0.935) | 92-95% | 實際代碼實現及測試結果 |

### 睡眠確認時間

心率和動作條件同時滿足需要持續的時間：

| 參數名稱 | 年齡組 | 確認時間 | 調整範圍 | 備註 |
|---------|--------|----------|----------|------|
| ConfirmationTimeTeen | 10–17 歲 (青少年) | 120 秒 (2分鐘) | 90-180 秒 | 青少年入睡通常較快，確認時間較短 |
| ConfirmationTimeAdult | 18–59 歲 (成人) | 180 秒 (3分鐘) | 120-240 秒 | 標準確認時間 |
| ConfirmationTimeSenior | ≥ 60 歲 (銀髮族) | 240 秒 (4分鐘) | 180-300 秒 | 老年人睡眠更為脆弱，需要更長確認 |

### 動作靜止比例閾值

判定用戶是否處於靜止狀態的比例門檻：

| 參數名稱 | 年齡組 | 閾值 | 調整範圍 | 備註 |
|---------|--------|------|----------|------|
| RestingRatioThresholdTeen | 10–17 歲 (青少年) | 80% (0.8) | 75-85% | 考慮青少年活動度較高 |
| RestingRatioThresholdAdult | 18–59 歲 (成人) | 85% (0.85) | 80-90% | 標準靜止比例 |
| RestingRatioThresholdSenior | ≥ 60 歲 (銀髮族) | 90% (0.9) | 85-95% | 考慮老年人活動強度較低 |

## 二、收斂機制參數

### 基礎調整參數

控制收斂機制的調整幅度和策略：

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| BaseAdjustment | 基礎調整量 | 0.01 (1%) | 0.005~0.02 | 單次調整的基本幅度 |
| MaxConsecutiveEffect | 連續同向調整最大影響因子 | 0.5 (50%) | 0.3~0.6 | 連續同向調整的最大增益 |
| InitialBoostFactor | 初始階段調整增益 | 1.2 (120%) | 1.0~1.5 | 系統初始階段的調整增益 |
| StableStageFactor | 穩定階段調整降低係數 | 0.8 (80%) | 0.5~0.9 | 系統穩定階段的調整減少 |

### 異常分數與觸發門檻（v2.4 更新）

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| DeviationScoreThreshold | 累積分數觸發收斂門檻 | **8 分** | 6-12 分 | scoreThreshold 常量 |
| ExtremeRatioThresholdLow | 極端低 ratio 閾值 | **0.94** | 0.90-0.96 | ratio < 值 → +3 分 |
| ExtremeRatioThresholdHigh | 極端高 ratio 閾值 | **1.10** | 1.08-1.15 | ratio > 值 → +3 分 |

### 反饋影響參數

用戶反饋對收斂機制的影響：

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| FalsePositivePenalty | 假陽性反饋懲罰係數 | 1.2 (120%) | 1.1~1.5 | 誤判為睡眠時的懲罰係數 |
| FalseNegativeBoost | 假陰性反饋增益係數 | 1.3 (130%) | 1.1~1.5 | 未能檢測睡眠時的增益係數 |
| DecayBase | 調整衰減基礎係數 | 0.95 (95%) | 0.9~1.0 | 避免過度調整的衰減係數 |
| ConsecutiveFeedbackMultiplier | 連續同類反饋乘數 | 1.2 (120%) | 1.1~1.5 | 連續同類反饋的影響倍數 |

### 系統優化觸發條件

啟動收斂機制的條件：

| 參數名稱 | 說明 | 閾值 | 備註 |
|---------|------|------|------|
| MinSessionsBeforeOptimize | 首次優化前最少會話數 | 5 | 確保有足夠數據進行優化 |
| MinDaysBeforeOptimize | 首次優化前最少天數 | 7 | 確保跨越不同日期和情境 |
| ForcedOptimizeDays | 強制優化間隔天數 | 14 | 兩週一次的強制檢查 |
| MinNewSessionsForOptimize | 常規優化前最少新會話數 | 3 | 需要積累足夠新數據 |
| MinDaysSinceLastOptimize | 常規優化間隔天數 | 7 | 保持優化間隔適當 |
| OptimizeAfterFeedbackDays | 反饋後優化等待天數 | 3 | 反饋後適當等待期 |

## 三、睡眠確認系統參數

### 睡眠狀態判定參數

控制睡眠確認系統的判定邏輯：

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| ConsecutiveHRConfirmations | 連續心率確認次數 | 3 | 2-5 | 連續幾次心率符合才初步判定 |
| MotionStabilityThreshold | 動作穩定度閾值 | 0.7 (70%) | 0.6-0.9 | 動作穩定度判定閾值 |
| MotionStabilityIncrement | 動作穩定度增加量 | 0.2 (20%) | 0.1-0.3 | 每次靜止狀態的增加量 |
| MotionStabilityDecrement | 動作穩定度減少量 | 0.3 (30%) | 0.2-0.5 | 每次動作狀態的減少量 |

### 信心度計算權重

睡眠確認信心度的計算權重：

| 參數名稱 | 說明 | 權重 | 備註 |
|---------|------|------|------|
| HeartRateConfidenceWeight | 心率貢獻權重 | 0.5 (50%) | 心率在判定中的權重 |
| MotionConfidenceWeight | 動作貢獻權重 | 0.3 (30%) | 動作在判定中的權重 |
| TimeConfidenceWeight | 時間貢獻權重 | 0.2 (20%) | 時間在判定中的權重 |

## 四、特殊模式參數

### 運動員模式參數

專為心臟功能強的運動員設計的特殊模式：

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| AthleteModeTriggerRHR | 觸發運動員模式的RHR閾值 | 45 bpm | 40-50 bpm | 低於此靜息心率自動啟用 |
| AthleteHRDropThreshold | 運動員心率下降絕對值閾值 | 5 bpm | 3-8 bpm | 心率下降超過此絕對值判定 |
| AthleteModeRRVThreshold | 運動員RR變異增強係數 | 1.5 (150%) | 1.3-1.8 | 強化RR變異分析靈敏度 |

### 碎片化睡眠模式參數

針對淺睡眠或睡眠中斷頻繁的用戶：

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| FragmentedSleepThreshold | 碎片化睡眠心率閾值增益 | 1.03 (103%) | 1.01-1.05 | 提高心率閾值百分比 |
| FragmentedSleepConfirmationTime | 碎片化睡眠確認時間係數 | 0.75 (75%) | 0.7-0.9 | 縮短確認時間 |
| FragmentedSleepMotionTolerance | 碎片化睡眠動作容忍度 | 1.15 (115%) | 1.1-1.3 | 增加對動作的容忍 |

## 五、監測與分析參數

### 心率監測參數

控制心率數據的收集和處理：

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| HeartRateSamplingInterval | 心率取樣間隔 | 5 秒 | 3-10 秒 | HealthKit 限制的取樣間隔 |
| HeartRateWindowSize | 心率分析窗口大小 | 60 秒 | 30-120 秒 | 分析窗口的時間跨度 |
| HeartRateSmoothing | 心率平滑係數 | 0.3 (30%) | 0.1-0.5 | 心率資料的平滑程度 |

### 動作監測參數

控制動作數據的收集和處理：

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| MotionSamplingRate | 動作取樣頻率 | 20 Hz | 10-50 Hz | 動作資料取樣頻率 |
| MotionAnalysisWindow | 動作分析窗口 | 15 秒 | 10-30 秒 | 動作分析的時間窗口 |
| AccelerometerThreshold | 加速度計靜止閾值 | 0.03 G | 0.01-0.06 G | 判定靜止的加速度閾值 |

## 六、使用者界面參數

### 手動調整範圍

使用者界面允許的調整範圍：

| 參數名稱 | 說明 | 預設值 | 調整範圍 | 備註 |
|---------|------|--------|----------|------|
| ManualHRThresholdAdjustment | 手動心率閾值調整範圍 | ±5% (±0.05) | -0.05 到 +0.05 | 用戶可調整的範圍 |
| ManualRRThresholdAdjustment | 手動靜止比例調整範圍 | ±10% (±0.1) | -0.1 到 +0.1 | 用戶可調整的範圍 |
| ManualConfirmationTimeAdjustment | 手動確認時間調整範圍 | ±30 秒 | -30 秒到 +60 秒 | 用戶可調整的範圍 |

### 反饋效果參數

用戶反饋的影響參數：

| 參數名稱 | 說明 | 預設值 | 備註 |
|---------|------|--------|------|
| FeedbackHRThresholdEffect | 反饋對心率閾值的影響 | ±2% (±0.02) | 每次反饋的影響量 |
| FeedbackConfirmationTimeEffect | 反饋對確認時間的影響 | ±15 秒 | 每次反饋的影響量 |
| FeedbackCoolingPeriod | 反饋冷卻期 | 24 小時 | 避免短時間內多次反饋 |

## 七、版本與更新記錄

| 版本 | 日期 | 主要更新 | 對應代碼版本 |
|------|------|----------|-------------|
| v1.0.0 | 2024-05-20 | 初始版本，整合所有技術參數 | PowerNap v2.3.1 |

---

**備註**：
1. 所有百分比參數在代碼中以小數表示（例如：90% = 0.9）
2. 時間參數在代碼中以秒為單位
3. 當需要更新任何參數時，請先修改本文件，並確保在所有相關文件中同步更新 